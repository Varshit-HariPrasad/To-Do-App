<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Awakened Todo — Simple To‑Do App</title>
<style>
  :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#60a5fa;--ok:#34d399}
  *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
  body{margin:0;background:linear-gradient(180deg,var(--bg),#071022);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
  .app{width:100%;max-width:760px}
  header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
  h1{margin:0;font-size:20px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
  .input-row{display:flex;gap:8px;margin-bottom:12px}
  input[type="text"]{flex:1;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;outline:none}
  button{background:var(--accent);border:none;padding:10px 14px;border-radius:8px;color:#032;cursor:pointer;font-weight:600}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer}
  ul{list-style:none;padding:0;margin:0}
  li{display:flex;align-items:center;gap:12px;padding:10px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.01)}
  li .title{flex:1}
  li.completed .title{text-decoration:line-through;color:var(--muted)}
  .small{font-size:12px;color:var(--muted)}
  .meta{display:flex;gap:8px;align-items:center}
  .chip{padding:6px 8px;border-radius:999px;border:1px solid rgba(255,255,255,0.03);font-size:13px;color:var(--muted)}
  .right{display:flex;gap:8px;align-items:center}
  .edit{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px 8px;border-radius:8px;cursor:pointer;color:var(--muted)}
  footer{margin-top:12px;display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px}
  @media (max-width:520px){header{flex-direction:column;align-items:flex-start} .controls{width:100%}}
</style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Awakened Todo</h1>
        <div class="small">Simple, local, private — stored in your browser</div>
      </div>
      <div style="margin-left:auto" class="chip">No account required</div>
    </header>

    <div class="card">
      <div class="input-row">
        <input id="taskInput" type="text" placeholder="Add a new task (press Enter or click +)" />
        <button id="addBtn" title="Add task">＋</button>
      </div>

      <div class="controls">
        <div>
          <label class="small">Filter:</label>
          <button class="btn-ghost" data-filter="all">All</button>
          <button class="btn-ghost" data-filter="active">Active</button>
          <button class="btn-ghost" data-filter="completed">Completed</button>
        </div>
        <div style="margin-left:auto">
          <button class="btn-ghost" id="clearCompleted">Clear completed</button>
          <button class="btn-ghost" id="exportBtn">Export</button>
          <button class="btn-ghost" id="importBtn">Import</button>
        </div>
      </div>

      <ul id="list"></ul>

      <footer>
        <div id="count">0 tasks</div>
        <div class="small">Made with ❤️ — stores data in localStorage</div>
      </footer>
    </div>
  </div>

<script>
const STORAGE_KEY = 'awakened_todo_v1';
let tasks = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]') || [];
let filter = 'all';

const elements = {
  list: document.getElementById('list'),
  input: document.getElementById('taskInput'),
  addBtn: document.getElementById('addBtn'),
  count: document.getElementById('count'),
  exportBtn: document.getElementById('exportBtn'),
  importBtn: document.getElementById('importBtn'),
  clearCompleted: document.getElementById('clearCompleted'),
  filterBtns: Array.from(document.querySelectorAll('[data-filter]'))
};

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
  render();
}

function addTask(text) {
  const t = text.trim();
  if(!t) return;
  tasks.unshift({id:Date.now().toString(36),text:t,done:false,created:Date.now()});
  save();
  elements.input.value = '';
}

function toggleDone(id) {
  tasks = tasks.map(x => x.id === id ? {...x,done:!x.done} : x);
  save();
}

function deleteTask(id) {
  tasks = tasks.filter(x => x.id !== id);
  save();
}

function editTask(id,newText) {
  tasks = tasks.map(x => x.id === id ? {...x,text:newText} : x);
  save();
}

function clearCompleted() {
  tasks = tasks.filter(t => !t.done);
  save();
}

function exportTasks() {
  const blob = new Blob([JSON.stringify(tasks, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'awakened-todo.json'; document.body.appendChild(a); a.click();
  setTimeout(()=>{URL.revokeObjectURL(url); a.remove();},500);
}

function importTasksFromFile(file) {
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const arr = JSON.parse(e.target.result);
      if(Array.isArray(arr)) {
        // merge preserving new ids
        const incoming = arr.map(x=>({...x,id:x.id || (Date.now().toString(36)+Math.random().toString(36).slice(2)), text:x.text||'', done:!!x.done, created:x.created||Date.now()}));
        tasks = [...incoming, ...tasks];
        save();
        alert('Imported '+incoming.length+' tasks');
      } else alert('Invalid file format');
    } catch(err){ alert('Could not parse JSON') }
  };
  reader.readAsText(file);
}

function render() {
  elements.list.innerHTML = '';
  const filtered = tasks.filter(t => filter === 'all' ? true : (filter === 'active' ? !t.done : t.done));
  filtered.forEach(t => {
    const li = document.createElement('li');
    if(t.done) li.classList.add('completed');
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox'; checkbox.checked = !!t.done;
    checkbox.addEventListener('change', ()=> toggleDone(t.id));
    const title = document.createElement('div');
    title.className = 'title';
    title.contentEditable = true;
    title.spellcheck = false;
    title.innerText = t.text;
    title.addEventListener('blur', ()=> { editTask(t.id, title.innerText.trim() || t.text); });
    title.addEventListener('keydown', (e)=> {
      if(e.key === 'Enter') { e.preventDefault(); title.blur(); }
    });

    const meta = document.createElement('div');
    meta.className = 'meta right';
    const created = document.createElement('div');
    created.className = 'small';
    const d = new Date(t.created);
    created.innerText = d.toLocaleString();
    const del = document.createElement('button');
    del.className = 'edit';
    del.innerText = 'Delete';
    del.addEventListener('click', ()=> { if(confirm('Delete this task?')) deleteTask(t.id); });

    meta.appendChild(created);
    meta.appendChild(del);

    li.appendChild(checkbox);
    li.appendChild(title);
    li.appendChild(meta);
    elements.list.appendChild(li);
  });

  elements.count.innerText = tasks.length + ' tasks';
}

elements.addBtn.addEventListener('click', ()=> addTask(elements.input.value));
elements.input.addEventListener('keydown', (e)=> { if(e.key === 'Enter') addTask(elements.input.value); });

elements.filterBtns.forEach(b => {
  b.addEventListener('click', ()=> {
    filter = b.dataset.filter;
    elements.filterBtns.forEach(x=>x.style.borderColor='rgba(255,255,255,0.04)');
    b.style.borderColor = 'var(--accent)';
    render();
  });
});

elements.clearCompleted.addEventListener('click', ()=> { if(confirm('Remove all completed tasks?')) clearCompleted(); });
elements.exportBtn.addEventListener('click', exportTasks);
elements.importBtn.addEventListener('click', ()=> {
  const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json';
  inp.onchange = ()=> { if(inp.files && inp.files[0]) importTasksFromFile(inp.files[0]) };
  inp.click();
});

window.addEventListener('storage', ()=> { tasks = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]') || []; render(); });

render();
</script>
</body>
</html>
